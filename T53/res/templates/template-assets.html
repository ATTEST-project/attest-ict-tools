<!DOCTYPE html>
<html lang="en">
  <head>
      <title>Action Suggested</title>
      <!-- <link rel="stylesheet" href="{{ resource_folder }}/css/table-assets.css"> -->
      <style>
        body{margin:0;padding:2rem;background:linear-gradient(45deg,#0692b2,#001e61);font-family:sans-serif;font-weight:100;background-repeat:no-repeat;background-attachment:fixed}@font-face{font-family:Arial_Rounded;src:url(../fonts/ARLRDBD.TTF),url(ARLRDBD.eot)}body{font-family:Arial_Rounded,sans-serif;background-color:#CCC;font-size:16px}.label-container{position:fixed;bottom:48px;right:105px;display:table;visibility:hidden}.label-text{color:#FFF;background:rgba(51,51,51,0.5);display:table-cell;vertical-align:middle;padding:10px;border-radius:3px}.label-arrow{display:table-cell;vertical-align:middle;color:#333;opacity:.5}.float{position:fixed;width:60px;height:60px;bottom:40px;right:40px;background-color:#05B9E3;color:#FFF;border-radius:50px;text-align:center}.my-float{font-size:24px;margin-top:18px}a.float + div.label-container{visibility:hidden;opacity:0;transition:visibility 0s,opacity .5s ease}a.float:hover + div.label-container{visibility:visible;opacity:1}.title{font-family:Arial_Rounded,sans-serif;font-style:normal;font-size:40px;font-weight:300;text-align:center;color:#fff}.container{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}table .center{text-align:left;position:relative;width:50%;box-shadow:-10px 0 20px rgba(0,0,0,0.1);empty-cells:hide;border-right:25px solid transparent}th,td{padding:15px;background-color:rgba(255,255,255,0.2);color:#fff}.div-assets th{position:sticky;top:0;box-shadow:0 2px 2px -1px rgba(0,0,0,0.4)}thead th{background-color:#000C66}thead tr.table-header th:hover{background-color:rgba(255,255,255,0.3)}tbody tr:hover{background-color:rgba(255,255,255,0.3)}tbody td:hover:before{content:"";position:absolute;left:0;right:0;z-index:-1}.div-weights tbody td{margin:0;padding:10px 5px}input.weightInput{border:none;border-style:dashed;border-width:1px;border-color:rgba(255,255,255,0.4);font-family:Arial_Rounded,sans-serif;background:rgba(255,255,255,0.0);color:#fff;font-size:16px;width:80px;text-align:center;margin:0}div.grid-container{display:grid;grid-template-rows:250px auto}div.div-weights{text-align:center;height:100%;width:50%;float:center;position:relative;margin-left:auto;margin-right:auto}div.div-assets{margin-left:auto;margin-right:auto;float:center}table.table-weights{float:center;position:center;text-align:center;width:100%}
      </style>
      <!-- <link rel="stylesheet" href="{{ resource_folder }}/css/sort.css"> -->
      <style>
        .table-sortable th{cursor:pointer}.table-sortable .th-sort-asc::after{content:"\25b4"}.table-sortable .th-sort-desc::after{content:"\25be"}.table-sortable .th-sort-asc::after,.table-sortable .th-sort-desc::after{margin-left:5px}.table-sortable .th-sort-asc,.table-sortable .th-sort-desc{background:rgba(0,0,0,0.1)}
      </style>
      <!--meta http-equiv="refresh" content="1"-->
  </head>
  <body>
    <div class="div-indicators">
      <!-- <p style="text-align: center;">
        <img class="center" src="{{ resource_folder }}/img/logo_white.png" alt="ATTEST">
      </p> -->
      <p class="title">Assets</p>
      <div class="grid-container">
        <div class="div-weights">
          <table id="weights" class="table-weights">
            <thead>
              <tr class="table-weights-header"> 
                <th> Indicator </th>
                <th> Weight </th>
                <th> Mean </th>
                <th> Std. </th>
              </tr>
            </thead>
            <tbody>
            {% for indicator, weight, mean, std in data_info %}
              <tr class="table-row">
                <td> {{ indicator }} </td>
                <!--td class='weight' contenteditable="true"> {{ weight }} </td-->
                {% if indicator == data_columns[-1] %}
                <td class="weight">
                  {{ weight }}
                </td>
                {% else %}
                <td class="weight">
                  <input class="weightInput" type="text" onfocus="this.select()" onmouseup="return false;" value="{{ weight }}"/>
                </td>
                {% endif %}
                <td class="mean">
                  {{ mean }}
                </td>
                <td class="std">
                  {{ std }}
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="div-assets">
          <table id="table-assets" class="center table-sortable">
            <thead>
              <tr class="table-header">
              {% for header in data.columns %}
                <th>{{ header }}</th>
              {% endfor %}
              </tr>
            </thead>
            <tbody>
            {% for row in data.to_numpy() %}
              <tr class="table-row">
              {% for value in row %}
                <td>{{ value }}</td>
              {% endfor %}
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <!-- <script src="{{ resource_folder }}/js/tablesort.js"></script> -->
  <script type="text/javascript">
    function sortTableByColumn(table,column,asc=true){const dirModifier=asc?1:-1;const tBody=table.tBodies[0];const rows=Array.from(tBody.querySelectorAll("tr"));const sortedRows=rows.sort((a,b)=>{const aColText=a.querySelector(`td:nth-child(${column+1})`).textContent.trim();const bColText=b.querySelector(`td:nth-child(${column+1})`).textContent.trim();return aColText>bColText?(1*dirModifier):(-1*dirModifier)});while(tBody.firstChild){tBody.removeChild(tBody.firstChild)}tBody.append(...sortedRows);table.querySelectorAll("th").forEach(th=>th.classList.remove("th-sort-asc","th-sort-desc"));table.querySelector(`th:nth-child(${column+1})`).classList.toggle("th-sort-asc",asc);table.querySelector(`th:nth-child(${column+1})`).classList.toggle("th-sort-desc",!asc)}document.querySelectorAll(".table-sortable th").forEach(headerCell=>{headerCell.addEventListener("click",()=>{const tableElement=headerCell.parentElement.parentElement.parentElement;const headerIndex=Array.prototype.indexOf.call(headerCell.parentElement.children,headerCell);const currentIsAscending=headerCell.classList.contains("th-sort-asc");sortTableByColumn(tableElement,headerIndex,!currentIsAscending)})});
  </script>
  <!-- <script src="{{ resource_folder }}/js/update-weights.js"></script> -->
  <script type="text/javascript">
    function getWeights(){let a=Array.from(document.getElementById("weights").tBodies[0].rows);a.pop();return a.map((e)=>{return parseFloat(e.cells[1].firstElementChild.value)})}function updateTotalIndicator(){const table=document.getElementById("table-assets");const tHead=table.tHead;const tBody=table.tBodies[0];const indicatorSet=new Set(Array.from(document.getElementById("weights").tBodies[0].rows).map(e=>{return e.cells[0].textContent.trim()}));const idxArray=Array.from(tHead.rows[0].cells).map((e,idx)=>{return[idx,e.innerHTML]}).filter((e)=>{return indicatorSet.has(e[1])}).map((e)=>{return e[0]});weights=getWeights();for(let row of tBody.rows){row.cells[row.cells.length-1].innerHTML=parseFloat(weights.reduce((t,w,i)=>{return t+w*parseFloat(row.cells[idxArray[i]].innerHTML)},0).toFixed(4))}}function updateMeanStdTotalIndicator(){const tBody=document.getElementById("table-assets").tBodies[0];const mean=Array.from(tBody.rows).reduce((t,row)=>{return t+parseFloat(row.cells[row.cells.length-1].innerHTML)},0.0)/tBody.rows.length;const variance=Array.from(tBody.rows).reduce((t,row)=>{return t+Math.pow(parseFloat(row.cells[row.cells.length-1].innerHTML)-mean,2)},0.0)/(tBody.rows.length-1);const tW=document.getElementById("weights");const tWidxMean=Array.from(tW.tHead.rows[0].cells).map((c)=>{return c.innerHTML.trim()}).indexOf("Mean");const tWidxStd=Array.from(tW.tHead.rows[0].cells).map((c)=>{return c.innerHTML.trim()}).indexOf("Std.");const tWLength=tW.tBodies[0].rows.length;tW.tBodies[0].rows[tWLength-1].cells[tWidxMean].innerHTML=mean.toFixed(4);tW.tBodies[0].rows[tWLength-1].cells[tWidxStd].innerHTML=Math.sqrt(variance).toFixed(4)}document.querySelectorAll("input.weightInput").forEach(e=>{e.addEventListener("keydown",(event)=>{if(event.keyCode==13){e.blur()}})});document.querySelectorAll(".weightInput").forEach((rowWeight,i)=>{rowWeight.addEventListener("focusout",()=>{let indicatorRows=Array.from(document.getElementById("weights").tBodies[0].rows);let totalIndicatorRows=indicatorRows.pop();let indicatorWeights=indicatorRows.map(row=>{return parseFloat(row.children[1].firstElementChild.value)});let totalSum=indicatorWeights.reduce((total,num)=>{return total+num},0);let totalDifference=0.0;let nextIndicatorIndex=(i+1)%indicatorRows.length;do{totalDifference=totalSum-1.0;indicatorWeights[nextIndicatorIndex]-=totalDifference;if(indicatorWeights[nextIndicatorIndex]<0.0){indicatorWeights[nextIndicatorIndex]=0.0}totalSum=indicatorWeights.reduce((total,num)=>{return total+num},0);nextIndicatorIndex=(nextIndicatorIndex+1)%indicatorRows.length}while(totalSum>1.0);for(let i=0;i<indicatorWeights.length;i++){indicatorRows[i].children[1].firstElementChild.value=parseFloat(indicatorWeights[i].toFixed(4))}updateTotalIndicator();updateMeanStdTotalIndicator()})});
  </script>
  </body>
</html>
